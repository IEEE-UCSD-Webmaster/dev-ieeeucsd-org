---
import { Authentication } from "../../scripts/pocketbase/Authentication";
import { Update } from "../../scripts/pocketbase/Update";
import { FileManager } from "../../scripts/pocketbase/FileManager";
import { Get } from "../../scripts/pocketbase/Get";
import { toast, Toaster } from "react-hot-toast";
import EventRequestFormPreview from "./Officer_EventRequestForm/EventRequestFormPreview";
import EventRequestForm from "./Officer_EventRequestForm/EventRequestForm";
---

<div class="w-full max-w-6xl mx-auto py-8 px-4">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-white mb-2">Event Request Form</h1>
    <p class="text-gray-300 mb-4">
      Submit your event request at least 6 weeks before your event. After
      submitting, please notify PR and/or Coordinators in the #-events Slack
      channel.
    </p>
    <div class="bg-base-300/50 p-4 rounded-lg text-sm text-gray-300">
      <p class="font-medium mb-2">This form includes sections for:</p>
      <ul class="list-disc list-inside space-y-1 ml-2">
        <li>PR Materials (if needed)</li>
        <li>Event Details</li>
        <li>TAP Form Information</li>
        <li>AS Funding (if needed)</li>
      </ul>
      <p class="mt-3">
        You can switch between the form and preview tabs at any time. Your
        progress is automatically saved.
      </p>
    </div>
  </div>

  <div class="bg-base-200 rounded-lg shadow-xl overflow-hidden">
    <div class="tabs tabs-boxed bg-base-300 rounded-t-lg">
      <button id="form-tab" class="tab tab-active">Submit Request</button>
      <button id="preview-tab" class="tab">Preview Request</button>
    </div>

    <div id="form-view" class="p-6">
      <EventRequestForm client:load />
    </div>

    <div id="preview-view" class="p-6 hidden">
      <EventRequestFormPreview client:load />
    </div>
  </div>
</div>

<script>
  // Tab switching logic
  const formTab = document.getElementById("form-tab");
  const previewTab = document.getElementById("preview-tab");
  const formView = document.getElementById("form-view");
  const previewView = document.getElementById("preview-view");

  formTab?.addEventListener("click", () => {
    formTab.classList.add("tab-active");
    previewTab?.classList.remove("tab-active");
    formView?.classList.remove("hidden");
    previewView?.classList.add("hidden");

    // Dispatch event to notify the preview component to update
    const event = new CustomEvent("updatePreview");
    document.dispatchEvent(event);
  });

  previewTab?.addEventListener("click", (e) => {
    // Prevent default behavior to avoid form submission
    e.preventDefault();

    previewTab.classList.add("tab-active");
    formTab?.classList.remove("tab-active");
    previewView?.classList.remove("hidden");
    formView?.classList.add("hidden");

    // Dispatch event to notify the preview component to update
    const event = new CustomEvent("updatePreview");
    document.dispatchEvent(event);
  });
</script>
